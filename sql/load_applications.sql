-- This script will read applications file generated by the go package and load to mysql database

CREATE TEMPORARY TABLE IF NOT EXISTS temp_Applications LIKE Applications;

DROP INDEX applId_index ON temp_Applications;

LOAD DATA LOCAL INFILE @infile
INTO TABLE temp_Applications
FIELDS TERMINATED BY '^'
LINES TERMINATED BY '\n'
(createdAt, updatedAt, applId, pedsData, title);

INSERT INTO Applications
SELECT * FROM temp_Applications
ON DUPLICATE KEY UPDATE updatedAt = VALUES(updatedAt), pedsData = VALUES(pedsData), title = VALUES(title);

DROP TEMPORARY TABLE temp_Applications;